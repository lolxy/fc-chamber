<v-layout>
  <div class="hbox hbox-auto-xs hbox-auto-sm">
    <div class="container auctions-list-wrap">
      <div class="row">
        <div class="col-sm-3">
          <div class="panel" v-for="typeItem in types">
            <div class="panel-heading m-b-n"><strong>{{ typeItem.Name }}</strong></div>
            <div class="panel-body">
              <div class="row filters-row">
                <div class="col-sm-12">
                  <el-select v-model="filters[`cat-${typeItem.Id}`]" :placeholder="`请选择${typeItem.Name}`" clearable>
                    <el-option
                      v-for="item in typeItem.Categories"
                      :key="item.Id"
                      :label="item.Name"
                      :value="item.Id">
                    </el-option>
                  </el-select>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <template v-for="item in list">
            <div class="stream-item" v-if="item.Id">
              <div class="stream-item-inner">
                <div class="stream-item-header wrapper-xs clearfix m-b-sm">
                  <div class="item-cover">
                    <template v-if="item.Images.length">
                      <img v-lazy="item.Images[0].ImgUri" alt="">
                    </template>
                  </div>
                  <div class="item-info">
                    <p class="title"><strong>{{ item.Title }}</strong></p>
                    <p class="qty"><span class="label-name">数量：</span> <span>{{ item.Qty }}</span> <span class="unit">{{ item.Unit }}</span></p>
                    <p class="production-type"><span class="label-name">底价：</span> <span>{{ item.StartPrice }} 元</span></p>
                    <p class="currprice"><span class="label-name">当前供应单价：</span> <strong class="price text-success">{{ formatPrice(item.CurrPrice) }}</strong> <span class="unit">元</span></p>
                    <p class="endtime"><span class="label-name">距离结束：</span>
                      <template v-if="!item.CloseTime">
                        <span class="end" v-if="isEnded(item.EndTime)">已结束</span>
                        <vue-countdown-2 :deadline="item.EndTime" v-if="!isEnded(item.EndTime)"></vue-countdown-2>
                      </template>
                      <template v-else>
                        <span class="end">已结束</span>
                      </template>
                    </p>
                    <p class="detail-link">
                      <a @click="openDetailDialog(item)"><i class="fa fa-eye"></i> 快速预览</a>
                      <router-link :to="{ name: 'circles.auctions.detail', params: { id: item.Id } }"><i class="fa fa-arrow-circle-right"></i> 查看详情</router-link>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </template>

          <infinite-loading :on-infinite="onStreamInfinite" spinner="waveDots" ref="streamInfiniteLoading">
            <span slot="no-more"><a href="#">返回顶部</a></span>
            <span slot="no-results">
              <placeholder text="暂无结果"></placeholder>
            </span>
          </infinite-loading>

          <el-dialog
            title="快速预览"
            size="small"
            v-model="detailDialogVisble" v-if="currentItem.Id">
            <div class="stream-item">
              <div class="stream-item-inner">
                <div class="stream-item-header wrapper-xs clearfix m-b-sm">
                  <div class="item-cover">
                    <template v-if="currentItem.Images.length">
                      <img v-lazy="currentItem.Images[0].ImgUri" alt="">
                    </template>
                  </div>
                  <div class="item-info">
                    <p class="title"><strong>{{ currentItem.Title }}</strong></p>
                    <p class="qty"><span class="label-name">数量：</span> <span>{{ currentItem.Qty }}</span> <span class="unit">{{ currentItem.Unit }}</span></p>
                    <p class="production-type"><span class="label-name">低价：</span> <span>{{ currentItem.StartPrice }} 元</span></p>
                    <p class="quoted-price"><span class="label-name">供应单价：</span> <strong>{{ formatPrice(currentItem.CurrPrice) }}</strong> <span class="unit">元</span></p>
                    <p class="end-time"><span class="label-name">距离结束：</span>
                      <template v-if="!currentItem.CloseTime">
                        <span class="end" v-if="isEnded(currentItem.EndTime)">已结束</span>
                        <vue-countdown-2 :deadline="currentItem.EndTime" v-if="!isEnded(currentItem.EndTime)"></vue-countdown-2>
                      </template>
                      <template v-else>
                        <span class="end">已结束</span>
                      </template>
                    </p>
                    <br>
                    <template v-if="currentItem.Publisher.Id == meId || getRoles('AuctionAdmin')">
                      <template v-if="!currentItem.CloseTime && !isEnded(currentItem.EndTime)">
                        <button class="btn btn-dark btn-block" @click="closeAuction(currentItem)"><i class="fa fa-pause"></i> 关闭当前供应</button>
                      </template>
                      <template v-else>
                        <button class="btn btn-success btn-block" @click="openAuction(currentItem)"><i class="fa fa-rotate-right"></i> 重新打开供应</button>
                      </template>
                      <button class="btn btn-danger btn-delete" @click="deleteAuction(currentItem)"><i class="fa fa-trash"></i> 删除</button>
                    </template>
                    <template v-if="currentItem.Publisher.Id !== meId">
                      <template v-if="!currentItem.CloseTime && !isEnded(currentItem.EndTime)">
                        <button class="btn btn-default btn-block" @click="askForThis(currentItem)"><i class="fa fa-comments-o"></i> 立即咨询（附带发送当前供应信息）</button>
                        <button class="btn btn-success btn-block" @click="openAuctionComment"><i class="fa fa-cart-arrow-down"></i> 我要报价</button>
                      </template>
                    </template>
                  </div>
                </div>
              </div>
            </div>
          </el-dialog>
        </div>
        <div class="col-sm-3">
          <div class="list-group m-n">
            <template v-for="item in menu">
              <a class="list-group-item" v-if="item.handle == 'create'" @click="openAuctionManager">
                <i class="fa" :class="item.icon"></i> {{ item.name }}
              </a>
              <a class="list-group-item" :class="{'active': item.handle == currentMenu}" @click="switchMenu(item.handle)" v-else>
                <i class="fa" :class="item.icon"></i> {{ item.name }}
              </a>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <el-dialog title="发布供应" v-model="auctionManagerVisible" size="small">
    <auction-manager :types="types" v-on:auctionManagerUpdate="onAuctionManagerUpdate"></auction-manager>
  </el-dialog>

  <el-dialog title="我要报价" v-model="auctionCommentVisible" size="tiny" v-if="currentItem.Id">
    <auction-comment :item="currentItem" v-on:close="onAuctionCommentClose"></auction-comment>
  </el-dialog>

  <el-dialog title="欢迎来到辅城，请先登录" v-model="loginDialogVisible" size="tiny">
    <login-dialog-form></login-dialog-form>
  </el-dialog>
</v-layout>
